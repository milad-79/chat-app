generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
}


// ============================
// USER
// ============================
model User {
  id        String       @id @default(uuid())
  username  String       @unique @db.VarChar(30)
  password  String
  isOnline  Boolean      @default(true)
  token     String?      @db.Text
  createdAt DateTime     @default(now())

  details   UserDetails?
  messages  Message[]

  @@map("users")
}

// ============================
// USER DETAILS (1:1)
// ============================
model UserDetails {
  userId    String   @id
  fullName  String   @db.VarChar(40)
  imageUrl  String?
  createdAt DateTime @default(now())
  updatedAt DateTime     @updatedAt

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_details")
}

// ============================
// CONVERSATION
// ============================
model Conversation {
  id        String  @id @default(uuid())
  endpoint  String  @unique @db.VarChar(30)
  title     String  @db.VarChar(30)
  imageUrl  String?
  updatedAt DateTime     @updatedAt

  rooms     Room[]
  createdAt DateTime @default(now())

  @@map("conversation")
}

// ============================
// ROOM
// ============================
model Room {
  id          String   @id @default(uuid())
  name        String   @db.VarChar(30)
  description String?  @db.VarChar(50)
  imageUrl    String?
  convId      String
  createdAt   DateTime @default(now())
  updatedAt   DateTime     @updatedAt

  conversation Conversation @relation(fields: [convId], references: [id], onDelete: Cascade)
  messages     Message[]

  @@unique([name, convId]) // unique room name per conversation
  @@map("rooms")
}

// ============================
// MESSAGE
// ============================
model Message {
  id        String       @id @default(uuid())
  text      String       @db.VarChar(150)
  status    Boolean      @default(false)
  createdAt DateTime     @default(now())

  roomId    String
  userId    String

  room      Room         @relation(fields: [roomId], references: [id], onDelete: Cascade)
  user      User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  files     MessageFile[]

  @@index([userId])
  @@map("messages")
}

// ============================
// FILE ATTACHMENT
// ============================
model MessageFile {
  id        String   @id @default(uuid())
  type      String   @db.VarChar(25)
  address   String
  createdAt DateTime @default(now())

  messageId String
  message   Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@index([messageId])
  @@map("message_files")
}
